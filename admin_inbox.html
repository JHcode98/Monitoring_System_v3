<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Inbox — Document Monitoring System</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>Admin Inbox</h1>
      <div class="header-right">
        <div id="clock" class="clock" aria-live="polite"></div>
        <div id="user-info" class="hidden">
          <span id="username-display"></span>
          <span id="role-badge" class="role-badge" style="display:none;margin-left:8px"></span>
         
        </div>
      </div>
    </header>

    <main>
      <!-- Admin-only inbox page. If not signed in as admin, users are redirected to the main dashboard. -->
      <section id="dashboard" class="hidden">
        <div style="max-width:980px;margin:18px auto;padding:0 16px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div>
              <a href="index.html">← Back to Dashboard</a>
            </div>
           
          </div>

          <div id="admin-inbox" class="card">
            <h3>Admin Inbox</h3>
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
              <select id="admin-inbox-filter">
                <option value="forwarded">Forwarded</option>
                <option value="received">Received</option>
                <option value="returned">Returned</option>
                <option value="all">All</option>
              </select>
              <input id="admin-inbox-search" placeholder="Search inbox..." style="flex:1;padding:6px;border:1px solid #e6eef8;border-radius:6px" />
            </div>
            <div id="admin-inbox-list"></div>
            <div id="admin-inbox-pagination" class="sidebar-pagination"></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <small>Local demo — data stored in your browser. <br>
      j.hutalla.</small>
    </footer>

    <!-- Reuse modal so View works here too -->
    <div id="doc-modal" class="modal hidden" aria-hidden="true">
      <div class="modal-overlay" id="modal-overlay"></div>
      <div class="modal-content card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <button class="modal-close" id="modal-close" title="Close"></button>
        <h2 id="modal-title">Document Details</h2>
        <form id="modal-doc-form">
          <label>Control Number</label>
          <input id="modal-control" name="controlNumber" required />
          <label>Owner</label>
          <input id="modal-owner" name="owner" />
          <!-- Title / Status / WINS removed from modal; use inline edit form instead -->
          <label>Created</label>
          <input id="modal-created" name="createdAt" type="datetime-local" />
          <label>Notes</label>
          <textarea id="modal-notes" name="notes" rows="4"></textarea>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button type="submit">Save</button>
            <button type="button" id="modal-open-new" title="Open in new tab">Open in new tab ↗</button>
            <button type="button" id="modal-cancel">Cancel</button>
          </div>
          <input type="hidden" id="modal-original-control" />
        </form>
      </div>
    </div>

    <script>
      // Admin-only landing: redirect non-admins back to the main dashboard and show inbox for admins
      document.addEventListener('DOMContentLoaded', () => {
        const role = localStorage.getItem('dms_auth_role_v1');
        const user = localStorage.getItem('dms_auth_v1');
        if(role !== 'admin'){
          alert('Admin access required. Redirecting to Dashboard.');
          window.location.href = 'index.html';
          return;
        }
        // show dashboard immediately
        const dash = document.getElementById('dashboard'); if(dash) dash.classList.remove('hidden');
        const ui = document.getElementById('user-info'); if(ui) ui.classList.remove('hidden');
        const uname = document.getElementById('username-display'); if(uname) uname.textContent = user || '';
        // wire refresh
        const btn = document.getElementById('refresh-inbox');
        if(btn) btn.addEventListener('click', () => { try{ window.renderAdminInbox && window.renderAdminInbox(); }catch(e){} });
        // render inbox once app is ready
        setTimeout(() => { try{ window.renderAdminInbox && window.renderAdminInbox(); }catch(e){} }, 100);
      });
    </script>

    <script src="app.js"></script>
  </body>
</html>
