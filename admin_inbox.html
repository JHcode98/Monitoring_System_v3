<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Inbox — Document Monitoring System</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
    <body>
    <header>
      <h1>Admin Inbox</h1>
      <div class="navbar" role="navigation">
        <div class="nav-left">
          <a href="documents_full.html" id="documents-full-page-btn" class="nav-btn" title="Open Full Documents View">Full Docs</a>
          <a href="admin_inbox.html" id="admin-inbox-page-btn" class="nav-btn" style="display:none" title="Open Admin Inbox Page">Admin Inbox</a>
        </div>
        <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
        <div class="navbar">
          <div class="nav-left">
            <a id="admin-inbox-page-btn" href="admin_inbox.html" class="icon-btn" title="Inbox">Inbox</a>
          </div>
          <div class="nav-center"><div class="nav-title">Monitoring System</div></div>
          <div class="nav-right">
            <div style="position:relative">
              <button id="admin-filter-btn" class="icon-btn" title="Inbox filters" aria-haspopup="true" aria-expanded="false"> 
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="10" y1="21" x2="10" y2="10"></line><line x1="16" y1="21" x2="16" y2="6"></line></svg>
              </button>
              <div id="admin-filter-menu" class="card" style="position:absolute;right:0;top:40px;display:none;padding:8px;min-width:140px;box-shadow:0 6px 18px rgba(0,0,0,0.12)">
                <button class="icon-btn admin-filter-item" data-filter="forwarded" title="Show forwarded">Forwarded</button>
                <button class="icon-btn admin-filter-item" data-filter="received" title="Show received">Received</button>
                <button class="icon-btn admin-filter-item" data-filter="returned" title="Show returned">Returned</button>
                <button class="icon-btn admin-filter-item" data-filter="all" title="Show all">All</button>
              </div>
            </div>
          </div>
        </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Admin-only inbox page. If not signed in as admin, users are redirected to the main dashboard. -->
      <section id="dashboard" class="hidden">
        <div style="max-width:980px;margin:18px auto;padding:0 16px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div>
              <a href="index.html">← Back to Dashboard</a>
            </div>
           
          </div>

          <div id="admin-inbox" class="card">
            <h3>Admin Inbox</h3>
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
              <input id="admin-inbox-search" placeholder="Search inbox..." style="flex:1;padding:6px;border:1px solid #e6eef8;border-radius:6px" />
            </div>
            <div id="admin-inbox-list"></div>
            <div id="admin-inbox-pagination" class="sidebar-pagination"></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <small>Local demo — data stored in your browser. <br>
      j.hutalla.</small>
    </footer>

    <!-- Reuse modal so View works here too -->
    <div id="doc-modal" class="modal hidden" aria-hidden="true">
      <div class="modal-overlay" id="modal-overlay"></div>
      <div class="modal-content card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <button class="modal-close" id="modal-close" title="Close"></button>
        <h2 id="modal-title">Document Details</h2>
        <form id="modal-doc-form">
          <label>Control Number</label>
          <input id="modal-control" name="controlNumber" required />
          <label>Owner</label>
          <input id="modal-owner" name="owner" />
          <!-- Title / Status / WINS removed from modal; use inline edit form instead -->
          <label>Created</label>
          <input id="modal-created" name="createdAt" type="datetime-local" />
          <label>Notes</label>
          <textarea id="modal-notes" name="notes" rows="4"></textarea>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button type="submit">Save</button>
            <button type="button" id="modal-open-new" title="Open in new tab">Open in new tab ↗</button>
            <button type="button" id="modal-cancel">Cancel</button>
          </div>
          <input type="hidden" id="modal-original-control" />
        </form>
      </div>
    </div>

    <script>
      // Admin-only landing: redirect non-admins back to the main dashboard and show inbox for admins
      document.addEventListener('DOMContentLoaded', () => {
        const role = localStorage.getItem('dms_auth_role_v1');
        const user = localStorage.getItem('dms_auth_v1');
        if(role !== 'admin'){
          alert('Admin access required. Redirecting to Dashboard.');
          window.location.href = 'index.html';
          return;
        }
        // show dashboard immediately
        const dash = document.getElementById('dashboard'); if(dash) dash.classList.remove('hidden');
        const ui = document.getElementById('user-info'); if(ui) ui.classList.remove('hidden');
        const uname = document.getElementById('username-display'); if(uname) uname.textContent = user || '';
        // wire refresh
        const btn = document.getElementById('refresh-inbox');
        if(btn) btn.addEventListener('click', () => { try{ window.renderAdminInbox && window.renderAdminInbox(); }catch(e){} });
        // render inbox once app is ready
        setTimeout(() => { try{ window.renderAdminInbox && window.renderAdminInbox(); }catch(e){} }, 100);
        // wire filter menu
        const filterBtn = document.getElementById('admin-filter-btn');
        const menu = document.getElementById('admin-filter-menu');
        if(filterBtn && menu){
          filterBtn.addEventListener('click', (e) => { e.stopPropagation(); const open = menu.style.display !== 'block'; menu.style.display = open ? 'block' : 'none'; filterBtn.setAttribute('aria-expanded', open ? 'true' : 'false'); });
          document.addEventListener('click', () => { menu.style.display = 'none'; filterBtn.setAttribute('aria-expanded','false'); });
          menu.querySelectorAll('.admin-filter-item').forEach(b => b.addEventListener('click', (ev) => {
            const f = b.getAttribute('data-filter');
            try{ if(window.setAdminInboxFilter) window.setAdminInboxFilter(f); else { localStorage.setItem('dms_admin_inbox_filter', f); } }catch(e){}
            menu.style.display = 'none'; filterBtn.setAttribute('aria-expanded','false');
          }));
        }
      });
    </script>

    <script src="app.js"></script>
    <!-- Profile modal -->
    <!-- profile moved to profile.html -->
  </body>
</html>
